# Mafia Tool

## Вступление

Утилита, предназначенная для игры в мафию в роли ведущего.  
Данная утилита обеспечивает полную игру в мафию с большим разнообразием ролей
и помогает ведущему в проведении игры, в том числе, какие фразы говорить игрокам,
как определить порядок ролей, кто кому и какой эффект может наложить игроку и 
что сказать в итоге, после проведения ночи игры.

## Структура файлов

В корневой папке находится папка с утилитой MafiaToolRelease, в ней содержатся следующие директории/файлы:
- `logs` - данная папка появляется после запуска приложения и в ней содержатся файлы логов использования утилиты. 
Формат имени файла лога имеет следующий вид: `yyyy-MM-dd.txt`, т.е. год-месяц-день записи логов, например 2024-02-01 - 1 февраля 2024 года.
- `Data` - папка с набором ключевых файлов данных для утилиты. В данной папке содержатся следующие файлы:
  - `roles.json` - файл данных с ролями игры. Роль имеет следующую структуру:
    - `RoleType` - тип роли, зашит в коде. Используется для удобного определения роли игрока и дальнейшей логики ночи.
    - `Priority` - приоритет роли. Определяет приоритет хода игрока. Чем меньше значение, тем раньше будет ход.
    - `Name` - имя роли. Используется для отображения в утилите.
    - `CasedNames` - набор названия роли во всех падежах.
    - `Side` - фракция роли (красная или чёрная). Красная - мирные и их союзники. Чёрные - мафия, маньяк, якудза и другие.
    - `CanBeMultiple` - флаг, обозначающий может ли быть несколько человек с данной ролью.
    - `Description` - описание роли. Используется для отображения в утилите.
    - `Abilities` - способности роли.
  - `game_history.json` - файл истории игр в мафию. Элемент истории игры имеет следующую структуру: ###***TODO***###
  - `last_game_players.json` - файл со списком игроков последней игры с их ролями. Может быть быстро восстановлен и отображён в утилите, 
  чтобы быстрее начать игру с теми же игроками.
  - `abilities.json` - файл с описанием способностей различных ролей. Способность имеет следующую структуру:
    - `Type` - тип способности, зашит в коде. Используется для внутренней логики утилиты.
    - `Name` - название способности. Используется для отображения в утилите.
    - `Description` - описание способности. Используется для отображения в утилите.
- `MafiaTool.exe` - исполняемый файл с утилитой. Запускает непосредственно утилиту.
- `nlog.config` - конфигурационный файл логгирования данных. Не изменять без соответствующих знаний.

## Описание функционала

Приложение находится в папке MafiaToolRelease, файл MafiaTool.exe - исполняемый файл.

После открытия приложения, появится главный экран приложения, выглядит он следующим образом: 

![MafiaTool - Main menu](/README_Images/main_menu.png)

На скриншоте ниже есть следующие элементы управления:

![MafiaTool - Main menu with instructions](/README_Images/main_menu_instruction.png)

1. Список ролей для добавления в игру.
2. Кнопка добавления роли из списка.
3. Список уже добавленных ролей в игру с указанием количества добавленных игроков данной роли.
4. Кнопка удаления роли из списка.
5. Кнопка генерации участников по ролям.
6. Список участников по ролям с возможностью указать имя участника.
7. Поле с описанем выбранной роли из п.1.
8. Поле с описанием способностей выбранной роли из п.1.
9. Кнопка старта игры.

Каждый элемент управления имеет свой функционал:
1. В списке ролей можно выбрать роль для добавления в игру. Роль выбирается по одной. Для добавления в игру, можно нажать на кнопку из п.2
или двойным нажатием на выбранную роль. 
2. Кнопка для добавления роли добавляет роль из списка из п.1. Для добавления роли, она должна быть выбрана в списке из п.1.  
*Примечание к п.1 и п.2:*  
Роль добавляется по одному человеку. Если роли не было - в списке выбранных ролей (п.3) появится новая роль,
если роль в списке есть, то количество человек с этой ролью увеличится на один.
3. Данный список отображает, какие роли были выбраны и сколько человек с определённой ролью будет в игре.
4. Кнопка удаляет роль из списка из п.3. Для удаления роли нужно выбрать в списке из п.3 роль для удаления и нажать эту кнопку.  
*Примечание к п.4:*
Выбранная роль удаляется не полностью, а уменьшает количество человек с данной ролью на один. Если остался один человек с выбранной ролью, то роль удаляется из списка из п.3.
5. Чтобы сгенерировать случайные роли игрокам, нужно нажать на кнопку генерации участников по ролям.
Система случайным образом сгенерирует игроков по ролям. Количество игроков считается по сумму игроков каждой роли и, соответственно,
на каждую роль будет сгенерировано выбранное из списка из п.3 количество игроков с определённой ролью. После генерации ролей, можно задать имена игрокам.
Список генерации отобразится в списке п.6.
6. В этом списке находятся сгенерированные по ролям участники игры. Список генерируется по кнопке из п.5.
После генерации ролей, покажутся прямоугольники с возможностью ввода имени игрока. Формат элемента списка имеет следующий вид:  
`Номер_Игрока. Имя_Игрока (Роль_игрока)`  
Например: 1. Ваня (Мафия).
7. В этом окне отображается описание выбранной роли из списка п.1 для понимания, что она делает в игре и дальнейшего распоряжения, стоит ли добавлять эту роль в игру и в каком количестве.
8. В этом окне описываются способности выбранной роли из списка п.1, которые будут использоваться игроками данной роли в игре.
9. При нажатии на эту кнопку начинается игра. Для начала игры, надо сгенерировать игроков с ролями.

###***TODO***###

## Пошаговая инструкция генерации ролей для игры (с конкретным примером)

1. Для начала надо определить, сколько игроков нужно, какие роли и в каком количестве они нужны.  
Возьмём, например, 8 игроков, среди которых:

   - 2 мафии
   - 4 мирных жителя
   - 1 доктор
   - 1 комиссар

2. После определения ролей и их количества, надо добавить их в список. 
Для этого надо нажатием на роль в списке из п.1 или двойным нажатием добавить роль в список из п.3.
Таким образом повторять для всех ролей, которые нам нужны. Получится следующее:

![MafiaTool - Filled roles list](/README_Images/filled_roles_list.png)

3. После выбора ролей, надо нажать на кнопку `Сгенерировать роли` и посмотреть результат в списке из п.6.
Будет это выглядеть следующим образом: 

![MafiaTool - Generated players](/README_Images/generated_players.png)

4. Может быть такое, что